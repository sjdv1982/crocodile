def do_pre_analysis(rsize, rmsd, scalevec, maxcostfrac):
    import numpy as np
    from .build_rotamers import estimate_nclust_curve, estimate_rmsd_dist, get_best_clustering_hierarchy
    r1size, r2size, r3size = rsize

    result = {}
    est_size = estimate_nclust_curve(rmsd, scalevec, r1size, r2size)

    result["nclust_curve"] = est_size
    rmsd_dist = estimate_rmsd_dist(list(est_size.keys()), scalevec, r3size)
    result["rmsd_dist"] = rmsd_dist

    hierarchy = get_best_clustering_hierarchy(est_size, rmsd_dist, rmsd, maxcostfrac)
    result["hierarchy"] = hierarchy 

    return result
